# üöÄ Postopus Production Deployment Guide - Render.com

## Quick Deployment Steps

### 1. Repository Setup
```bash
# Ensure all files are committed to Git
git add .
git commit -m "Production deployment ready"
git push origin main
```

### 2. Render.com Deployment

#### Option A: Blueprint Deployment (Recommended)
1. Go to [Render Dashboard](https://dashboard.render.com)
2. Click "New" ‚Üí "Blueprint" 
3. Connect your GitHub repository
4. Select `render.yaml` file
5. Click "Apply" - Render will automatically create all services

#### Option B: Manual Service Creation
If blueprint fails, create services manually:

**Web Service:**
- Type: Web Service
- Build Command: `pip install -r requirements.txt`
- Start Command: `gunicorn src.web.main:app -w 4 -k uvicorn.workers.UvicornWorker --bind 0.0.0.0:$PORT`
- Environment: Python 3.11

**Database:**
- Type: PostgreSQL
- Name: `postopus-db`
- Database: `postopus`
- User: `postopus_user`

**Redis:**
- Type: Redis
- Name: `postopus-redis`

### 3. Environment Variables
Add these in Render dashboard:

#### Required Variables:
```
SECRET_KEY=<auto-generated-by-render>
DATABASE_URL=<auto-from-postgres-service>
REDIS_URL=<auto-from-redis-service>
ENVIRONMENT=production
```

#### Optional VK API Variables:
```
VK_API_VERSION=5.131
VK_APP_ID=your-vk-app-id
VK_CLIENT_SECRET=your-vk-client-secret
```

#### Optional Telegram Variables:
```
TELEGRAM_BOT_TOKEN=your-telegram-bot-token
```

### 4. Deploy and Test

Once deployed, your app will be available at:
`https://your-app-name.onrender.com`

Test endpoints:
- Health: `https://your-app-name.onrender.com/health`
- API Info: `https://your-app-name.onrender.com/api/info`
- Login: `https://your-app-name.onrender.com/api/auth/login`

## üîß Configuration Details

### Database Schema
The app will automatically handle database setup with graceful fallbacks:
- PostgreSQL preferred for production
- Demo data fallback if database unavailable
- Automatic migration on startup

### Authentication
Demo users available immediately:
- Admin: `admin/admin` (full access)
- Editor: `editor/editor123` (limited access)

### Regional Support
All 15 Russian regions supported:
`mi, nolinsk, arbazh, kirs, slob, verhosh, bogord, yaransk, viatpol, zuna, darov, kilmez, lebazh, omut, san`

## üõ†Ô∏è Troubleshooting

### Common Issues:

**Build Fails:**
- Check `requirements.txt` is present
- Verify Python 3.11 compatibility
- Check logs for missing dependencies

**App Won't Start:**
- Verify `PORT` environment variable
- Check database connection in logs
- Ensure all required env vars are set

**Database Connection Issues:**
- App will fall back to demo data
- Check PostgreSQL service status
- Verify `DATABASE_URL` format

### Debug Commands:
```bash
# Check logs
render logs --service your-service-name

# Shell access (if needed)
render shell --service your-service-name

# Environment variables
render env --service your-service-name
```

## üìä Post-Deployment

### 1. Initial Setup
- Access `/api/auth/login` with demo credentials
- Configure VK tokens via `/api/settings/vk-tokens`
- Create users via `/api/settings/users`

### 2. API Documentation
Available at (if debug enabled):
- Swagger UI: `https://your-app.onrender.com/docs`
- ReDoc: `https://your-app.onrender.com/redoc`

### 3. Monitoring
- Health endpoint: `/health`
- System stats: `/api/settings/system/stats`
- Health check: `/api/settings/system/health-check`

## üîê Security Notes

### Production Security:
- JWT tokens expire in 60 minutes
- Passwords use BCrypt hashing
- VK tokens are masked in responses
- CORS configured for production
- Debug endpoints disabled in production

### Recommended Next Steps:
1. Change default demo passwords
2. Add real VK API tokens
3. Configure proper CORS origins
4. Set up monitoring/alerting
5. Add SSL certificate (handled by Render)

## üéØ Success Indicators

‚úÖ **Deployment Successful When:**
- Health endpoint returns `{"status": "healthy"}`
- Authentication works with demo users
- Dashboard shows regional statistics
- Posts CRUD operations function
- Settings management accessible

‚úÖ **Production Ready When:**
- Real VK tokens configured
- Custom users created
- CORS origins restricted
- Monitoring enabled
- Backup procedures in place

---

**Need Help?** Check Render logs or contact support with this deployment configuration.