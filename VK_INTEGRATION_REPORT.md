# üîó –ò–¢–û–ì–û–í–´–ô –û–¢–ß–ï–¢: –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å VK API –¥–ª—è Postopus

## ‚úÖ **–†–ï–ó–£–õ–¨–¢–ê–¢–´ –ò–ù–¢–ï–ì–†–ê–¶–ò–ò:**

### üöÄ **–°–æ–∑–¥–∞–Ω–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ VK –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏:**

#### 1. **ModernVKService** - –°–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–π VK API —Å–µ—Ä–≤–∏—Å
- ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–µ—Ç `httpx` –≤–º–µ—Å—Ç–æ —É—Å—Ç–∞—Ä–µ–≤—à–µ–π –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ `vk_api`
- ‚úÖ –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ —Ç–æ–∫–µ–Ω—ã –¥–ª—è —Ä–∞–∑–Ω—ã—Ö —Ä–µ–≥–∏–æ–Ω–æ–≤
- ‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω rate limiting (3 –∑–∞–ø—Ä–æ—Å–∞ –≤ —Å–µ–∫—É–Ω–¥—É)
- ‚úÖ –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è —Ä–∞–±–æ—Ç–∞ —Å VK API
- ‚úÖ –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å PostgreSQL –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è —Ç–æ–∫–µ–Ω–æ–≤ –∏ –≥—Ä—É–ø–ø

#### 2. **Celery –∑–∞–¥–∞—á–∏** - –§–æ–Ω–æ–≤—ã–µ –∑–∞–¥–∞—á–∏ –¥–ª—è VK API
- ‚úÖ `fetch_posts_from_region_task` - –ø–æ–ª—É—á–µ–Ω–∏–µ –ø–æ—Å—Ç–æ–≤ –∏–∑ VK –≥—Ä—É–ø–ø
- ‚úÖ `publish_post_to_vk_task` - –ø—É–±–ª–∏–∫–∞—Ü–∏—è –ø–æ—Å—Ç–æ–≤ –≤ VK –≥—Ä—É–ø–ø—ã
- ‚úÖ `test_vk_connections_task` - —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–π
- ‚úÖ `process_scheduled_posts_task` - –æ–±—Ä–∞–±–æ—Ç–∫–∞ –∑–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –ø–æ—Å—Ç–æ–≤
- ‚úÖ `update_post_statistics_task` - –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –ø–æ—Å—Ç–æ–≤
- ‚úÖ `sync_all_regions_task` - —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –≤—Å–µ—Ö —Ä–µ–≥–∏–æ–Ω–æ–≤

#### 3. **API Endpoints** - REST API –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è VK –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–µ–π
- ‚úÖ `/api/vk/tokens` - —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ VK —Ç–æ–∫–µ–Ω–∞–º–∏ (CRUD)
- ‚úÖ `/api/vk/groups` - —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ VK –≥—Ä—É–ø–ø–∞–º–∏
- ‚úÖ `/api/vk/test-connections` - —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–π
- ‚úÖ `/api/vk/fetch-posts` - –ø–æ–ª—É—á–µ–Ω–∏–µ –ø–æ—Å—Ç–æ–≤ –∏–∑ —Ä–µ–≥–∏–æ–Ω–æ–≤
- ‚úÖ `/api/vk/publish-post` - –ø—É–±–ª–∏–∫–∞—Ü–∏—è –ø–æ—Å—Ç–æ–≤
- ‚úÖ `/api/vk/sync-all-regions` - —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –≤—Å–µ—Ö —Ä–µ–≥–∏–æ–Ω–æ–≤
- ‚úÖ `/api/vk/statistics` - —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ VK –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏

## üèóÔ∏è **–¢–ï–•–ù–ò–ß–ï–°–ö–ê–Ø –ê–†–•–ò–¢–ï–ö–¢–£–†–ê:**

### üìä **–ú–æ–¥–µ–ª–∏ –¥–∞–Ω–Ω—ã—Ö:**
```python
# VKToken - —Ç–æ–∫–µ–Ω—ã –¥–ª—è —Ä–µ–≥–∏–æ–Ω–æ–≤
- id, region, token, group_id
- description, is_active
- created_at, updated_at, last_used

# Group - VK –≥—Ä—É–ø–ø—ã
- id, name, group_id, region
- platform, is_active, description
- post_count, last_post_at, error_count

# Post - –ø–æ—Å—Ç—ã —Å VK –¥–∞–Ω–Ω—ã–º–∏
- id, title, content, region, theme
- status, vk_post_id, vk_group_id
- created_at, published_at
```

### üîÑ **–ü–æ—Ç–æ–∫ –¥–∞–Ω–Ω—ã—Ö:**
1. **–ü–æ–ª—É—á–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–æ–≤** –∏–∑ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
2. **–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è VK —Å–µ—Å—Å–∏–π** –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Ä–µ–≥–∏–æ–Ω–∞
3. **–ü–æ–ª—É—á–µ–Ω–∏–µ –ø–æ—Å—Ç–æ–≤** –∏–∑ VK –≥—Ä—É–ø–ø —Ä–µ–≥–∏–æ–Ω–∞
4. **–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –ø–æ—Å—Ç–æ–≤** –≤ PostgreSQL
5. **–ü—É–±–ª–∏–∫–∞—Ü–∏—è –ø–æ—Å—Ç–æ–≤** –≤ —Ü–µ–ª–µ–≤—ã–µ VK –≥—Ä—É–ø–ø—ã
6. **–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏** –∏ —Å—Ç–∞—Ç—É—Å–æ–≤

## üéØ **–§–£–ù–ö–¶–ò–û–ù–ê–õ–¨–ù–û–°–¢–¨:**

### ‚úÖ **–†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏:**

#### 1. **–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–∞–º–∏:**
- –°–æ–∑–¥–∞–Ω–∏–µ, –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ, —É–¥–∞–ª–µ–Ω–∏–µ VK —Ç–æ–∫–µ–Ω–æ–≤
- –ü—Ä–∏–≤—è–∑–∫–∞ —Ç–æ–∫–µ–Ω–æ–≤ –∫ —Ä–µ–≥–∏–æ–Ω–∞–º
- –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏ —Ç–æ–∫–µ–Ω–æ–≤
- –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

#### 2. **–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≥—Ä—É–ø–ø–∞–º–∏:**
- –î–æ–±–∞–≤–ª–µ–Ω–∏–µ VK –≥—Ä—É–ø–ø –¥–ª—è —Ä–µ–≥–∏–æ–Ω–æ–≤
- –ü–æ–ª—É—á–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –≥—Ä—É–ø–ø–∞—Ö
- –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ –≥—Ä—É–ø–ø
- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ—Å—Ç–æ–≤ –ø–æ –≥—Ä—É–ø–ø–∞–º

#### 3. **–°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –ø–æ—Å—Ç–æ–≤:**
- –ü–æ–ª—É—á–µ–Ω–∏–µ –ø–æ—Å—Ç–æ–≤ –∏–∑ VK –≥—Ä—É–ø–ø
- –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ —Ä–µ–≥–∏–æ–Ω–∞–º –∏ —Ç–µ–º–∞–º
- –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö
- –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ –∏ –ø–æ–≤—Ç–æ—Ä–Ω—ã–µ –ø–æ–ø—ã—Ç–∫–∏

#### 4. **–ü—É–±–ª–∏–∫–∞—Ü–∏—è –ø–æ—Å—Ç–æ–≤:**
- –ü—É–±–ª–∏–∫–∞—Ü–∏—è –≤ –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –≥—Ä—É–ø–ø—ã
- –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç–µ–∫—Å—Ç–∞ —Å —Ä–µ–≥–∏–æ–Ω–∞–ª—å–Ω—ã–º–∏ —Ö–µ—à—Ç–µ–≥–∞–º–∏
- –û–±—Ä–∞–±–æ—Ç–∫–∞ –≤–ª–æ–∂–µ–Ω–∏–π (—Ñ–æ—Ç–æ, –≤–∏–¥–µ–æ)
- Rate limiting –¥–ª—è –∏–∑–±–µ–∂–∞–Ω–∏—è –±–ª–æ–∫–∏—Ä–æ–≤–æ–∫

#### 5. **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞:**
- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Ç–æ–∫–µ–Ω–æ–≤ –∏ –≥—Ä—É–ø–ø
- –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ —É—Å–ø–µ—à–Ω–æ—Å—Ç–∏ –ø—É–±–ª–∏–∫–∞—Ü–∏–π
- –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –æ—à–∏–±–æ–∫ API
- –ê–Ω–∞–ª–∏—Ç–∏–∫–∞ –ø–æ —Ä–µ–≥–∏–æ–Ω–∞–º

## üìã **–°–û–ó–î–ê–ù–ù–´–ï –§–ê–ô–õ–´:**

### üîß **–û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã:**
- `src/services/modern_vk_service.py` - —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–π VK API —Å–µ—Ä–≤–∏—Å
- `src/tasks/vk_tasks.py` - Celery –∑–∞–¥–∞—á–∏ –¥–ª—è VK API
- `src/web/routers/vk.py` - API endpoints –¥–ª—è VK –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏
- `init_vk_tokens.py` - —Å–∫—Ä–∏–ø—Ç –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ VK —Ç–æ–∫–µ–Ω–æ–≤

### üìä **–û–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã:**
- `src/web/data_manager.py` - –¥–æ–±–∞–≤–ª–µ–Ω—ã –º–µ—Ç–æ–¥—ã –¥–ª—è VK –¥–∞–Ω–Ω—ã—Ö
- `src/web/main_render.py` - –ø–æ–¥–∫–ª—é—á–µ–Ω VK —Ä–æ—É—Ç–µ—Ä
- `requirements_render.txt` - –¥–æ–±–∞–≤–ª–µ–Ω–∞ –ø–æ–¥–¥–µ—Ä–∂–∫–∞ VK API

## üöÄ **–°–õ–ï–î–£–Æ–©–ò–ï –®–ê–ì–ò:**

### 1. **–ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Ä–µ–∞–ª—å–Ω—ã—Ö —Ç–æ–∫–µ–Ω–æ–≤:**
```bash
# –ó–∞–ø—É—Å–∫ —Å–∫—Ä–∏–ø—Ç–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏
python init_vk_tokens.py

# –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Ä–µ–∞–ª—å–Ω—ã—Ö VK —Ç–æ–∫–µ–Ω–æ–≤ —á–µ—Ä–µ–∑ API
POST /api/vk/tokens
{
  "region": "mi",
  "token": "vk1.a.real_token_here",
  "group_id": "-123456789",
  "description": "–†–µ–∞–ª—å–Ω—ã–π —Ç–æ–∫–µ–Ω –¥–ª—è –ú–∞–ª–º—ã–∂–∞"
}
```

### 2. **–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–π:**
```bash
# –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö —Ç–æ–∫–µ–Ω–æ–≤
GET /api/vk/test-connections

# –ü–æ–ª—É—á–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
GET /api/vk/statistics
```

### 3. **–°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö:**
```bash
# –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –≤—Å–µ—Ö —Ä–µ–≥–∏–æ–Ω–æ–≤
POST /api/vk/sync-all-regions

# –ü–æ–ª—É—á–µ–Ω–∏–µ –ø–æ—Å—Ç–æ–≤ –∏–∑ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ —Ä–µ–≥–∏–æ–Ω–∞
POST /api/vk/fetch-posts
{
  "region": "mi",
  "count": 20
}
```

### 4. **–ü—É–±–ª–∏–∫–∞—Ü–∏—è –ø–æ—Å—Ç–æ–≤:**
```bash
# –ü—É–±–ª–∏–∫–∞—Ü–∏—è –ø–æ—Å—Ç–∞
POST /api/vk/publish-post
{
  "post_id": 123,
  "target_groups": ["-123456789", "-987654321"],
  "region": "mi"
}
```

## üéâ **–ó–ê–ö–õ–Æ–ß–ï–ù–ò–ï:**

**–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å VK API –¥–ª—è Postopus —É—Å–ø–µ—à–Ω–æ –∑–∞–≤–µ—Ä—à–µ–Ω–∞!**

- ‚úÖ **–°–æ–≤—Ä–µ–º–µ–Ω–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞** —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º httpx –∏ async/await
- ‚úÖ **–ü–æ–ª–Ω–∞—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è** —Å PostgreSQL –∏ Celery
- ‚úÖ **REST API** –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –≤—Å–µ–º–∏ –∞—Å–ø–µ–∫—Ç–∞–º–∏ VK –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏
- ‚úÖ **–†–µ–≥–∏–æ–Ω–∞–ª—å–Ω–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞** –¥–ª—è 15+ —Ä–µ–≥–∏–æ–Ω–æ–≤
- ‚úÖ **Rate limiting** –∏ –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫
- ‚úÖ **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞** —Ä–∞–±–æ—Ç—ã —Å VK API
- ‚úÖ **–ì–æ—Ç–æ–≤–Ω–æ—Å—Ç—å –∫ –ø—Ä–æ–¥–∞–∫—à–µ–Ω—É** —Å –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–º –¥–µ–ø–ª–æ–µ–º

**–°–∏—Å—Ç–µ–º–∞ –≥–æ—Ç–æ–≤–∞ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å —Ä–µ–∞–ª—å–Ω—ã–º–∏ VK —Ç–æ–∫–µ–Ω–∞–º–∏ –∏ –≥—Ä—É–ø–ø–∞–º–∏!** üöÄ

## üìö **–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è API:**

### üîë **VK Token Management:**
- `GET /api/vk/tokens` - —Å–ø–∏—Å–æ–∫ —Ç–æ–∫–µ–Ω–æ–≤
- `POST /api/vk/tokens` - —Å–æ–∑–¥–∞–Ω–∏–µ —Ç–æ–∫–µ–Ω–∞
- `PUT /api/vk/tokens/{id}` - –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–∞
- `DELETE /api/vk/tokens/{id}` - —É–¥–∞–ª–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–∞

### üìä **VK Operations:**
- `GET /api/vk/test-connections` - —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–π
- `POST /api/vk/fetch-posts` - –ø–æ–ª—É—á–µ–Ω–∏–µ –ø–æ—Å—Ç–æ–≤
- `POST /api/vk/publish-post` - –ø—É–±–ª–∏–∫–∞—Ü–∏—è –ø–æ—Å—Ç–∞
- `POST /api/vk/sync-all-regions` - —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —Ä–µ–≥–∏–æ–Ω–æ–≤
- `GET /api/vk/statistics` - —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏

### üìà **Monitoring:**
- `GET /api/vk/tasks/{task_id}/status` - —Å—Ç–∞—Ç—É—Å –∑–∞–¥–∞—á
- `GET /api/vk/groups` - —Å–ø–∏—Å–æ–∫ –≥—Ä—É–ø–ø
- `GET /api/vk/groups/{id}/info` - –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –≥—Ä—É–ø–ø–µ
