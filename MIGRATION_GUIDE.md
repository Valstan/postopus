# –†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ –º–∏–≥—Ä–∞—Ü–∏–∏ –¥–∞–Ω–Ω—ã—Ö –∏–∑ MongoDB –≤ PostgreSQL

## –û–±–∑–æ—Ä

–≠—Ç–æ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ–º–æ–∂–µ—Ç –≤–∞–º –ø–µ—Ä–µ–Ω–µ—Å—Ç–∏ –¥–∞–Ω–Ω—ã–µ –∏–∑ –≤–∞—à–µ–π —Å—Ç–∞—Ä–æ–π MongoDB –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö –≤ –Ω–æ–≤—É—é PostgreSQL –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö –Ω–∞ Render.com.

## –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞

### 1. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

```bash
pip install pymongo sqlalchemy psycopg2-binary passlib
```

### 2. –ü–æ–ª—É—á–∏—Ç–µ –¥–∞–Ω–Ω—ã–µ –¥–ª—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è

**MongoDB (–≤–∞—à–∞ —Å—Ç–∞—Ä–∞—è –±–∞–∑–∞):**
- URL –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è (–Ω–∞–ø—Ä–∏–º–µ—Ä: `mongodb://user:password@host:port/`)
- –ò–º—è –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö (–æ–±—ã—á–Ω–æ `postopus`)

**PostgreSQL (Render.com):**
- Host: –ø–æ–ª—É—á–∏—Ç–µ –∏–∑ –ø–∞–Ω–µ–ª–∏ Render.com
- Port: 5432
- Database: `mikrokredit`
- User: `mikrokredit_user`
- Password: –ø–æ–ª—É—á–∏—Ç–µ –∏–∑ –ø–∞–Ω–µ–ª–∏ Render.com

## –í–∞—Ä–∏–∞–Ω—Ç—ã –º–∏–≥—Ä–∞—Ü–∏–∏

### –í–∞—Ä–∏–∞–Ω—Ç 1: –ü—Ä—è–º–∞—è –º–∏–≥—Ä–∞—Ü–∏—è (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)

–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Å–∫—Ä–∏–ø—Ç `migrate_mongo_to_postgres.py` –¥–ª—è –ø—Ä—è–º–æ–π –º–∏–≥—Ä–∞—Ü–∏–∏:

```bash
python migrate_mongo_to_postgres.py
```

–°–∫—Ä–∏–ø—Ç –∑–∞–ø—Ä–æ—Å–∏—Ç:
1. URL MongoDB
2. URL PostgreSQL

### –í–∞—Ä–∏–∞–Ω—Ç 2: –≠–∫—Å–ø–æ—Ä—Ç/–ò–º–ø–æ—Ä—Ç —á–µ—Ä–µ–∑ JSON

–ï—Å–ª–∏ –ø—Ä—è–º–∞—è –º–∏–≥—Ä–∞—Ü–∏—è –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç, –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –¥–≤—É—Ö—ç—Ç–∞–ø–Ω—ã–π –ø—Ä–æ—Ü–µ—Å—Å:

#### –®–∞–≥ 1: –≠–∫—Å–ø–æ—Ä—Ç –∏–∑ MongoDB

```bash
python export_mongo_data.py
```

–°–∫—Ä–∏–ø—Ç —Å–æ–∑–¥–∞—Å—Ç:
- `mongo_export/postopus_export_YYYYMMDD_HHMMSS.json` - –ø–æ–ª–Ω—ã–π —ç–∫—Å–ø–æ—Ä—Ç
- `mongo_export/collection_name.json` - –æ—Ç–¥–µ–ª—å–Ω—ã–µ —Ñ–∞–π–ª—ã –¥–ª—è –∫–∞–∂–¥–æ–π –∫–æ–ª–ª–µ–∫—Ü–∏–∏

#### –®–∞–≥ 2: –ò–º–ø–æ—Ä—Ç –≤ PostgreSQL

```bash
python import_to_postgres.py
```

–°–∫—Ä–∏–ø—Ç –∑–∞–ø—Ä–æ—Å–∏—Ç –ø—É—Ç—å –∫ JSON —Ñ–∞–π–ª—É –∏ URL PostgreSQL.

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∞–Ω–Ω—ã—Ö

### –ß—Ç–æ –º–∏–≥—Ä–∏—Ä—É–µ—Ç—Å—è:

1. **–ü–æ—Å—Ç—ã** - –∏–∑ –≤—Å–µ—Ö –∫–æ–ª–ª–µ–∫—Ü–∏–π (–∫—Ä–æ–º–µ —Å–ª—É–∂–µ–±–Ω—ã—Ö)
2. **–ì—Ä—É–ø–ø—ã** - –∏–∑ `config.all_my_groups`
3. **–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏** - –∏–∑ –∫–æ–ª–ª–µ–∫—Ü–∏–∏ `users`
4. **–†–∞—Å–ø–∏—Å–∞–Ω–∏—è** - –∏–∑ –∫–æ–ª–ª–µ–∫—Ü–∏–∏ `tasks`

### –°–ª—É–∂–µ–±–Ω—ã–µ –∫–æ–ª–ª–µ–∫—Ü–∏–∏ (–Ω–µ –º–∏–≥—Ä–∏—Ä—É—é—Ç—Å—è):
- `settings`
- `logs`
- `statistics`
- `health_checks`
- `task_executions`
- `config` (—á–∞—Å—Ç–∏—á–Ω–æ)
- `deserter`
- `bal`

## –ü–æ–ª—É—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ Render.com

### 1. –í–æ–π–¥–∏—Ç–µ –≤ –ø–∞–Ω–µ–ª—å Render.com

### 2. –ù–∞–π–¥–∏—Ç–µ –≤–∞—à—É PostgreSQL –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö `mikrokredit-db`

### 3. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ –¥–∞–Ω–Ω—ã–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è:
- **Host**: `dpg-xxxxx-a.oregon-postgres.render.com`
- **Port**: `5432`
- **Database**: `mikrokredit`
- **User**: `mikrokredit_user`
- **Password**: `xxxxx`

### 4. –°—Ñ–æ—Ä–º–∏—Ä—É–π—Ç–µ URL:
```
postgresql://mikrokredit_user:password@dpg-xxxxx-a.oregon-postgres.render.com:5432/mikrokredit
```

## –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### –ü—Ä—è–º–∞—è –º–∏–≥—Ä–∞—Ü–∏—è

```bash
python migrate_mongo_to_postgres.py
```

–í–≤–µ–¥–∏—Ç–µ:
- MongoDB URL: `mongodb://user:pass@your-mongo-host:27017/`
- PostgreSQL URL: `postgresql://mikrokredit_user:pass@dpg-xxxxx-a.oregon-postgres.render.com:5432/mikrokredit`

### –≠–∫—Å–ø–æ—Ä—Ç/–ò–º–ø–æ—Ä—Ç

```bash
# –≠–∫—Å–ø–æ—Ä—Ç
python export_mongo_data.py
# –í–≤–µ–¥–∏—Ç–µ MongoDB URL

# –ò–º–ø–æ—Ä—Ç
python import_to_postgres.py
# –í–≤–µ–¥–∏—Ç–µ –ø—É—Ç—å –∫ JSON —Ñ–∞–π–ª—É –∏ PostgreSQL URL
```

## –ü—Ä–æ–≤–µ—Ä–∫–∞ –º–∏–≥—Ä–∞—Ü–∏–∏

–ü–æ—Å–ª–µ –º–∏–≥—Ä–∞—Ü–∏–∏ –ø—Ä–æ–≤–µ—Ä—å—Ç–µ:

1. **–í–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å**: `https://your-app.onrender.com`
2. **API**: `https://your-app.onrender.com/api/info`
3. **Health check**: `https://your-app.onrender.com/health`

## –£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º

### –û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ MongoDB
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ URL –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
- –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ MongoDB –¥–æ—Å—Ç—É–ø–Ω–∞ –∏–∑ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–∞
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —É—á–µ—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ

### –û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ PostgreSQL
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ URL –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
- –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö —Å–æ–∑–¥–∞–Ω–∞ –Ω–∞ Render.com
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —É—á–µ—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ

### –û—à–∏–±–∫–∏ –∏–º–ø–æ—Ä—Ç–∞ –¥–∞–Ω–Ω—ã—Ö
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ —Å–∫—Ä–∏–ø—Ç–∞
- –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ JSON —Ñ–∞–π–ª –Ω–µ –ø–æ–≤—Ä–µ–∂–¥–µ–Ω
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞ –∫ —Ñ–∞–π–ª–∞–º

## –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

‚ö†Ô∏è **–í–∞–∂–Ω–æ**: 
- –ù–µ —Å–æ—Ö—Ä–∞–Ω—è–π—Ç–µ –ø–∞—Ä–æ–ª–∏ –≤ —Å–∫—Ä–∏–ø—Ç–∞—Ö
- –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –¥–ª—è —á—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
- –£–¥–∞–ª–∏—Ç–µ –≤—Ä–µ–º–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã –ø–æ—Å–ª–µ –º–∏–≥—Ä–∞—Ü–∏–∏

## –ü–æ–¥–¥–µ—Ä–∂–∫–∞

–ï—Å–ª–∏ –≤–æ–∑–Ω–∏–∫–ª–∏ –ø—Ä–æ–±–ª–µ–º—ã:

1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ —Å–∫—Ä–∏–ø—Ç–æ–≤
2. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤—Å–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –±–∞–∑–∞–º –¥–∞–Ω–Ω—ã—Ö
4. –û–±—Ä–∞—Ç–∏—Ç–µ—Å—å –∑–∞ –ø–æ–º–æ—â—å—é —Å –æ–ø–∏—Å–∞–Ω–∏–µ–º –æ—à–∏–±–∫–∏

## –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Å–∫—Ä–∏–ø—Ç—ã

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–∞–Ω–Ω—ã—Ö –≤ PostgreSQL

```python
from src.web.database import engine
from src.web.models import Post, Group, User, Schedule

# –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ
from sqlalchemy.orm import sessionmaker
SessionLocal = sessionmaker(autocommit=False, autoflush=False, bind=engine)
session = SessionLocal()

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ—Å—Ç–æ–≤
posts_count = session.query(Post).count()
print(f"–ü–æ—Å—Ç–æ–≤: {posts_count}")

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –≥—Ä—É–ø–ø
groups_count = session.query(Group).count()
print(f"–ì—Ä—É–ø–ø: {groups_count}")

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
users_count = session.query(User).count()
print(f"–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π: {users_count}")

session.close()
```

–£–¥–∞—á–∏ —Å –º–∏–≥—Ä–∞—Ü–∏–µ–π! üöÄ
